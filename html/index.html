<html>
	<head>
		<script type="text/javascript">
			function valveStat(input) {
				var valve = parseInt(input);
				var result = new Array();
				for(i = 0; i < 3; i++) {
					if(valve & 1 == 1)
						result.push(' checked="true"');
					else
						result.push('');
					valve = valve >> 1;
				}
				return result;
			}
			function refresh() {
				var xmlhttp;
				if (window.XMLHttpRequest)
					xmlhttp = new XMLHttpRequest();
				else
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						var response = xmlhttp.responseText;
						var data = '';
						if(response == "")
							data = "<hl>无设备</hl>";
						else {
							var jsonArr = JSON.parse(response);
							for(var i in jsonArr) {
								data += '<form action="/valveHandle" method="post">';
								data += "<p>设备编号: " + jsonArr[i].id + "<br>";
								data += "最后更新: " + jsonArr[i].date + "<br>";
								data += "温度: " + jsonArr[i].temp + "<br>";
								data += "湿度: " + jsonArr[i].humid + "<br>";
								data += "照度: " + jsonArr[i].lux + "<br>";
								data += "风速: " + jsonArr[i].spd + "<br>";
								data += "<label>电磁阀状态:</label>";
								var stat = valveStat(jsonArr[i].valve);
								data += '<input type="hidden" name="id" value="' + jsonArr[i].id + '">';
								data += '<label><input type="checkbox" value="0" name="cli' + jsonArr[i].id + '_1"' + stat[0] + '>3</label>';
								data += '<label><input type="checkbox" value="1" name="cli' + jsonArr[i].id + '_2"' + stat[1] + '>2</label>';
								data += '<label><input type="checkbox" value="2" name="cli' + jsonArr[i].id + '_3"' + stat[2] + '>1</label>';
								data += '<label><input type="submit" value="设置"></p></form>';
							}
						}
						document.getElementById("data").innerHTML = data;
					}
				}
				xmlhttp.open("GET", "/getData", true);
				xmlhttp.send();
			}
			refresh()
			window.setInterval('refresh()', 5000);
		</script>
	</head>
	<body>
		<input type="button" value="注销" onclick="window.location.href='/logout'"/>
		<input type="button" value="导出数据" onclick="window.location.href='/downLog'"/><br />
		<div id="data"></div>
	</body>
</html>